# Render deployment configuration for Forecast Pro
# PostgreSQL database: $7/month starter plan

databases:
  - name: forecast-pro-db
    plan: starter  # $7/month - 1GB storage, 97 connections
    databaseName: forecasting
    user: forecast_user

services:
  - type: web
    name: forecast-pro
    runtime: python
    buildCommand: pip install -r requirements.txt && alembic upgrade head
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /
    envVars:
      # Python version
      - key: PYTHON_VERSION
        value: "3.11.7"

      # Environment
      - key: ENVIRONMENT
        value: production
      - key: DEBUG
        value: "false"

      # Database - automatically set from Render PostgreSQL
      - key: DATABASE_URL
        fromDatabase:
          name: forecast-pro-db
          property: connectionString

      # Security - auto-generated
      - key: JWT_SECRET_KEY
        generateValue: true

      # CORS - UPDATE THIS with your actual domain
      - key: CORS_ORIGINS
        value: '["https://forecast-pro.onrender.com"]'

      # OAuth redirect base URL - UPDATE with your domain
      - key: OAUTH_REDIRECT_BASE_URL
        value: https://forecast-pro.onrender.com

      # Scheduler settings
      - key: SYNC_ENABLED
        value: "true"
      - key: SYNC_SCHEDULE_HOUR
        value: "2"

      # Integration credentials - set these manually in Render dashboard
      # Square
      - key: SQUARE_APP_ID
        sync: false
      - key: SQUARE_APP_SECRET
        sync: false
      - key: SQUARE_ENVIRONMENT
        value: production

      # Toast
      - key: TOAST_CLIENT_ID
        sync: false
      - key: TOAST_CLIENT_SECRET
        sync: false
      - key: TOAST_ENVIRONMENT
        value: production

      # Clover
      - key: CLOVER_APP_ID
        sync: false
      - key: CLOVER_APP_SECRET
        sync: false
      - key: CLOVER_ENVIRONMENT
        value: production

      # Shopify
      - key: SHOPIFY_API_KEY
        sync: false
      - key: SHOPIFY_API_SECRET
        sync: false

      # Sentry error monitoring - set manually in Render dashboard
      - key: SENTRY_DSN
        sync: false
